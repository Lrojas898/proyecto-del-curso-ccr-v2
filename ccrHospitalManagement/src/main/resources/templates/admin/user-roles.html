<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Gestionar Roles de <span th:text="${userRoleDTO.username}"></span></title>
    <link rel="stylesheet" href="/css/roles.css" />
</head>
<body>
<div class="container">
    <div class="card">
        <div class="card-header">
            <h1>Gestionar Roles para <span th:text="${userRoleDTO.username}"></span></h1>
        </div>
        <div class="card-body">
            <div id="error-alert" class="alert alert-danger" style="display: none;">
                Por favor, selecciona al menos un rol.
            </div>
            <form id="roles-form" th:action="@{/admin/users/{id}/roles(id=${userRoleDTO.userId})}" method="post" class="user-roles-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <div class="form-group">
                    <div class="checkbox-group">
                        <div th:each="role : ${userRoleDTO.availableRoles}">
                            <label>
                                <input type="checkbox"
                                       name="roleIds"
                                       th:value="${role.id}"
                                       th:checked="${userRoleDTO.assignedRoleIds.contains(role.id)}" />
                                <span th:text="${role.name}"></span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <a th:href="@{/admin/users}" class="btn btn-secondary">Volver</a>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    document.getElementById('roles-form').addEventListener('submit', function(event) {
        const checkboxes = document.querySelectorAll('input[name="roleIds"]:checked');
        const errorAlert = document.getElementById('error-alert');

        if (checkboxes.length === 0) {
            event.preventDefault(); // Evitar enviar el formulario
            errorAlert.style.display = 'block'; // Mostrar la alerta
            setTimeout(() => {
                errorAlert.style.display = 'none'; // Ocultar después de 3 segundos
            }, 3000);
        } else {
            errorAlert.style.display = 'none'; // Asegurar que la alerta esté oculta
        }
    });
</script>
</body>
</html>