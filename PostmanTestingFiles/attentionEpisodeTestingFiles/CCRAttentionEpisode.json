{
    "info": {
        "name": "CCRAttentionEpisode",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "item": [

        {
            "name": "Crear AttentionEpisode (Doctor)",
            "request": {
              "method": "POST",
              "header": [
                { "key": "Content-Type", "value": "application/json" },
                { "key": "Authorization", "value": "Bearer {{doctor_token}}" }
              ],
              "url": "{{base_url}}/attention-episodes",
              "body": {
                "mode": "raw",
                "raw": "{\n  \"creationDate\": \"2024-12-01\",\n  \"diagnosis\": \"Dolor de cabeza persistente\",\n  \"description\": \"El paciente refiere dolor desde hace 3 días.\",\n  \"clinicalHistoryId\": \"{{clinical_history_id}}\",\n  \"doctorId\": \"{{doctor_id}}\",\n  \"appointmentId\": \"{{appointment_id}}\"\n}"
              }
            },
            "event": [{
              "listen": "test",
              "script": {
                "exec": [
                  "let json = pm.response.json();",
                  "pm.environment.set(\"attention_episode_id\", json.id);",
                  "pm.test(\"AttentionEpisode creado con éxito\", () => pm.response.code === 200);"
                ],
                "type": "text/javascript"
              }
            }]
          },

          {
            "name": "Listar AttentionEpisodes (Doctor)",
            "request": {
              "method": "GET",
              "header": [
                { "key": "Authorization", "value": "Bearer {{doctor_token}}" }
              ],
              "url": "{{base_url}}/attention-episodes"
            },
            "event": [{
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Listado de episodios recibido\", () => pm.response.code === 200);"
                ],
                "type": "text/javascript"
              }
            }]
          },

          {
            "name": "Obtener AttentionEpisode por ID (Doctor)",
            "request": {
              "method": "GET",
              "header": [
                { "key": "Authorization", "value": "Bearer {{doctor_token}}" }
              ],
              "url": "{{base_url}}/attention-episodes/{{attention_episode_id}}"
            },
            "event": [{
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Detalle del episodio recibido\", () => pm.response.code === 200);"
                ],
                "type": "text/javascript"
              }
            }]
          },

          {
            "name": "Actualizar AttentionEpisode (Doctor)",
            "request": {
              "method": "PUT",
              "header": [
                { "key": "Content-Type", "value": "application/json" },
                { "key": "Authorization", "value": "Bearer {{doctor_token}}" }
              ],
              "url": "{{base_url}}/attention-episodes",
              "body": {
                "mode": "raw",
                "raw": "{\n  \"id\": {{attention_episode_id}},\n  \"creationDate\": \"2024-12-01\",\n  \"diagnosis\": \"Actualizado: migraña intensa\",\n  \"description\": \"El paciente ahora reporta mareos.\",\n  \"clinicalHistoryId\": \"{{clinical_history_id}}\",\n  \"doctorId\": \"{{doctor_id}}\",\n  \"appointmentId\": \"{{appointment_id}}\"\n}"
              }
            },
            "event": [{
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Episodio actualizado\", () => pm.response.code === 200);"
                ],
                "type": "text/javascript"
              }
            }]
          },

          {
            "name": "Eliminar AttentionEpisode (Admin)",
            "request": {
              "method": "DELETE",
              "header": [
                { "key": "Authorization", "value": "Bearer {{admin_token}}" }
              ],
              "url": "{{base_url}}/attention-episodes/{{attention_episode_id}}"
            },
            "event": [{
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Episodio eliminado (204)\", () => pm.response.code === 204);"
                ],
                "type": "text/javascript"
              }
            }]
          }
    ]
}
